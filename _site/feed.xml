<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>陈辉的博客</title>
    <description>stay healthy stay brave</description>
    <link>http://0.0.0.0:4000/</link>
    <atom:link href="http://0.0.0.0:4000/feed.xml" rel="self" type="application/rss+xml" />
    <pubDate>Mon, 17 Aug 2020 11:53:03 +0800</pubDate>
    <lastBuildDate>Mon, 17 Aug 2020 11:53:03 +0800</lastBuildDate>
    <generator>Jekyll v4.1.1</generator>
    
      <item>
        <title>WebRTC把玩记之一</title>
        <description>&lt;div id=&quot;wx_logo&quot; style=&quot;margin:0 auto;display:none;&quot;&gt;
&lt;img src=&quot;/img/v.jpg&quot; /&gt;
&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;https://apprtc.51buck.com&quot;&gt;&lt;img src=&quot;/img/click.jpg&quot; alt=&quot;alt text&quot; title=&quot;点我&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;做了这么久的直播，其实只是高延时的普通直播，和现在市面上大行其道的互动直播区别还是比较大的。互动直播需要更高的实时性和低延时，而且需要适应终端多人连麦的各种需求，这种双向交互的互动直播与电视台式的单向广播式的普通直播在技术上还是有较大的区别。&lt;/p&gt;

&lt;p&gt;WebRTC是google在收购Global IP Solutions公司已有技术的基础上开源出来的一套支持网页实时音视频通话框架，国内市面上的互动直播基础上都是在WebRTC的框架上进行的二次开发，很少自己发明轮子的。&lt;/p&gt;

&lt;p&gt;利用WebRTC可以衍生出很多好玩的应用，比如&lt;a href=&quot;https://webcamtoy.com/zh/&quot;&gt;Webcam Toy&lt;/a&gt;和&lt;a href=&quot;https://idevelop.ro/ascii-camera/&quot;&gt;ASCII Camera&lt;/a&gt;，值得一提的是我们用了很久的QQ视频聊天其实就是来自Global IP Solutions公司，只不过是WebRTC闭源商业版。下面要介绍的是一个使用WebRTC的典型网站&lt;a href=&quot;https://appr.tc&quot;&gt;AppRTC&lt;/a&gt;，她能够支持网页上的点对点的音视频聊天，但由于我朝大局域网的原因，这个网站国内是无法访问的。下面我介绍自己搭建一个类AppRTC&lt;a href=&quot;https://apprtc.51buck.com&quot;&gt;网站&lt;/a&gt;的步骤。先上图吧&lt;/p&gt;

&lt;p&gt;大图是PC上传的流，右下角的小图是手机上采的流。PC走的是普通局域网，手机是走的4G网络。&lt;/p&gt;

&lt;h2 id=&quot;1依赖环境安装&quot;&gt;1.依赖环境安装&lt;/h2&gt;
&lt;p&gt;ubuntu nginx java go node python GAE (google app engine sdk), 这些依赖最好手工下载安装。
nginx安装好后配置一个https的host，我用的域名是&lt;strong&gt;apprtc.51buck.com&lt;/strong&gt;，大家参考的时候只要替换成自己的域名就行。&lt;/p&gt;

&lt;p&gt;下面是我安装后的bashrc&lt;/p&gt;

&lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;export JAVA_HOME=/usr/local/java/jdk1.8.0_151
export CLASSPATH=.:$JAVA_HOME/jre/lib/rt.jar:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar
export PATH=$JAVA_HOME/bin:$PATH

export GOROOT=/usr/local/go/v1.9.2
export GOPATH=~/Works/go
export GOBIN=$GOPATH/bin
export GOARCH=amd64
export GOOS=linux
export PATH=$GOROOT/bin:$GOPATH/bin:$PATH

export GAE=/home/buck/Works/Alphabet/google-cloud-sdk
source $GAE/completion.bash.inc
source $GAE/path.bash.inc
export PATH=$GAE/bin:$PATH

export NODE_HOME=/usr/local/node/v8.9.1
export PATH=$NODE_HOME/bin:$PATH

#export http_proxy=http://xxxxx:yyyyy
#export https_proxy=http://xxxxx:yyyyy
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;在安装和初始化GAE的时候要翻墙，记得设置代理服务器。
安装GAE后需要按如下步骤进行初始化，根据提示一步一步做就行：&lt;/p&gt;

&lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;cd $GAE
./google-cloud-sdk/install.sh
gcloud init --skip-diagnostics
gcloud components install app-engine-python
gcloud components install app-engine-python-extras
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;2组件安装&quot;&gt;2.组件安装&lt;/h2&gt;
&lt;p&gt;一个AppRTC应用需要三个建立在WebRTC框架上的组件
包括&lt;strong&gt;房间服务器&lt;/strong&gt;、&lt;strong&gt;信号服务器&lt;/strong&gt;、&lt;strong&gt;打孔服务器&lt;/strong&gt;。其中前面两个都在apprtc项目中，最后一个在coturn项目中。&lt;/p&gt;

&lt;h3 id=&quot;21房间服务器&quot;&gt;2.1房间服务器&lt;/h3&gt;

&lt;h4 id=&quot;211-先安装&quot;&gt;2.1.1 先安装&lt;/h4&gt;
&lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;git clone https://github.com/webrtc/apprtc
cd apprtc
npm install -g grunt-cli
npm install
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;212-再修改两处源文件&quot;&gt;2.1.2 再修改两处源文件：&lt;/h4&gt;
&lt;p&gt;src/app_engine/constants.py&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;TURN_BASE_URL&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'https://computeengineondemand.appspot.com'&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;改成&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;TURN_BASE_URL&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'https://apprtc.51buck.com'&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;ICE_SERVER_BASE_URL&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'https://networktraversal.googleapis.com'&lt;/span&gt; 
&lt;span class=&quot;n&quot;&gt;改成&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;ICE_SERVER_BASE_URL&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'https://apprtc.51buck.com'&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;两处&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;WSS_INSTANCE_HOST_KEY&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'apprtc-ws.webrtc.org:443'&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;改成&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;WSS_INSTANCE_HOST_KEY&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'apprtc.51buck.com:28089'&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;./src/web_app/js/appcontroller.js
添加一行代码强制将https转成http：&lt;/p&gt;

&lt;div class=&quot;language-js highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;err&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Add&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;By&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Buck&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;roomLink&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;roomLink&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;substring&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;https&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;history&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;pushState&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;roomId&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;roomId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;roomLink&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;roomLink&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;roomId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;roomLink&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;213-再编译&quot;&gt;2.1.3 再编译：&lt;/h4&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;grunt build
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;214-后台启动即可&quot;&gt;2.1.4 后台启动即可&lt;/h4&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;nohup &lt;/span&gt;dev_appserver.py &lt;span class=&quot;nt&quot;&gt;--host&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;127.0.0.1 &lt;span class=&quot;nt&quot;&gt;--port&lt;/span&gt; 18085 &lt;span class=&quot;nt&quot;&gt;--admin_host&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0.0.0.0 &lt;span class=&quot;nt&quot;&gt;--admin_port&lt;/span&gt; 18000 &lt;span class=&quot;nt&quot;&gt;--log_level&lt;/span&gt; debug out/app_engine/ &amp;amp;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;22信号服务器&quot;&gt;2.2信号服务器&lt;/h3&gt;
&lt;h4 id=&quot;221-在apprtc项目目录执行&quot;&gt;2.2.1 在apprtc项目目录执行&lt;/h4&gt;
&lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; ln -s `pwd`/src/collider/collider $GOPATH/src
 ln -s `pwd`/src/collider/collidermain $GOPATH/src
 ln -s `pwd`/src/collider/collidertest $GOPATH/src
 cd $GOPATH/src/collidermain
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;222-修改文件maingo&quot;&gt;2.2.2 修改文件main.go:&lt;/h4&gt;
&lt;div class=&quot;language-go highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;将&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;roomSrv&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;flag&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;room-server&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;https://appr.tc&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;The origin of the room server&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;改成&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;roomSrv&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;flag&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;room-server&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;https://apprtc.51buck.com&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;The origin of the room server&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;223-生成验证文件&quot;&gt;2.2.3 生成验证文件：&lt;/h4&gt;
&lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mkdir /cert
openssl genrsa -des3 -out key.pem 2048
openssl req -new -key key.pem -out server.csr
cp key.pem server.key.org
openssl rsa -in server.key.org -out key.pem
openssl x509 -req -days 365 -in server.csr -signkey key.pem -out cert.pem
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;224-后台运行服务&quot;&gt;2.2.4 后台运行服务&lt;/h4&gt;
&lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;nohup ./collidermain -port=28089 -tls=true -room-server='http://127.0.0.1:18085' &lt;span class=&quot;err&quot;&gt;&amp;amp;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;23打孔服务器&quot;&gt;2.3打孔服务器&lt;/h3&gt;

&lt;h4 id=&quot;231-安装&quot;&gt;2.3.1 安装&lt;/h4&gt;

&lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;git clone https://github.com/coturn/coturn
cd coturn
./configure
make -j 4
make install
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;232-添加用户&quot;&gt;2.3.2 添加用户&lt;/h4&gt;

&lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  turnadmin -a -u buck -r apprtc.51buck.com -p buck
  turnadmin -A -u buck -p buck
  turnadmin -k -u buck -p buck -r apprtc.51buck.com
  0xe00a389a1f3dad029491a16c254e32b5
记住上面这条输出密码，填入下面的配置文件中
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;233-修改配置&quot;&gt;2.3.3 修改配置&lt;/h4&gt;

&lt;p&gt;examples/etc/turnserver.conf&lt;/p&gt;
&lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;listening-device=eth0
listening-port=3478
relay-device=eth0
min-port=59000
max-port=60000
Verbose
fingerprint
lt-cred-mech
use-auth-secret
static-auth-secret=buck
user=buck:buck
user=buck:0x9db00ade3d323a3f9d1180b72983e5e9
realm=apprtc.51buck.com
stale-nonce=600
cert=/root/coturn/examples/etc/turn_server_cert.pem
pkey=/root/coturn/examples/etc/turn_server_pkey.pem
no-loopback-peers
no-multicast-peers
mobility
no-cli
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;233-后台启动服务&quot;&gt;2.3.3 后台启动服务：&lt;/h4&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;nohup&lt;/span&gt; ./bin/turnserver &lt;span class=&quot;nt&quot;&gt;-a&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; examples/etc/turnserver.conf &amp;amp;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;上面具体参数的含义这就不多解释了，自行google吧&lt;/p&gt;

&lt;h3 id=&quot;24其它辅助服务器&quot;&gt;2.4其它辅助服务器&lt;/h3&gt;

&lt;h4 id=&quot;241-nginx&quot;&gt;2.4.1 nginx&lt;/h4&gt;
&lt;p&gt;last but not least, 还需要配置nginx服务器将用户的url请求转发到对应的上述三个服务器上
如何配置https这里就不说了，在这基础上添加两项路由匹配&lt;/p&gt;

&lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; location / {
      #root   html;
      #index  testssl.html index.html index.htm;

      proxy_redirect off;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_pass http://127.0.0.1:18085/;
  }

  location /v1alpha/iceconfig { 
      #add_header Access-Control-Allow-Origin *;
      #proxy_redirect off;
      #proxy_set_header Host $host;
      #proxy_set_header X-Real-IP $remote_addr;
      #proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_pass http://127.0.0.1:3033/v1alpha/iceconfig; 
  } 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;242-打孔查询服务器&quot;&gt;2.4.2 打孔查询服务器&lt;/h4&gt;
&lt;p&gt;上面的两条路由，第一条是转发到房间服务器的，第二条是为了获取打孔服务器列表的，返回列表的服务器用js简单写一个就行
主要逻辑就是监听3033端口，处理转发过来的http post请求，返回2.3中设置好的打孔服务器列表。&lt;/p&gt;

&lt;p&gt;文件名ice.js&lt;/p&gt;
&lt;div class=&quot;language-js highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;express&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;express&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;crypto&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;crypto&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;app&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;express&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;hmac&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;method&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;crypto&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;createHmac&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;sha1&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;method&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;setEncoding&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;base64&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;method&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;method&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;method&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;nx&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;post&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;/v1alpha/iceconfig&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;req&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;resp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;query&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;req&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;query&lt;/span&gt;
  &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;key&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;apprtc.51buck.com&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;
  &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;time_to_live&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;600&lt;/span&gt;
  &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;timestamp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Math&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;floor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;Date&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;now&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;time_to_live&lt;/span&gt;
  &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;turn_username&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;timestamp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;:buck&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;
  &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;password&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;hmac&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;turn_username&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;resp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;iceServers&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;urls&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;
          &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;stun:apprtc.51buck.com:3478&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;turn:apprtc.51buck.com:3478&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;username&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;turn_username&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;credential&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;password&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;

&lt;span class=&quot;nx&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;listen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;3033&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;server started&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;后台启动&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;nohup &lt;/span&gt;node ice.js &amp;amp;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;3结语&quot;&gt;3.结语&lt;/h2&gt;

&lt;p&gt;搭好后实现测试发现，PC Chrome和Android使用都没啥问题，但iOS无法使用，记得今年6月份iOS 11已经全面支持WebRTC，具体是啥原因后面再分析吧。
搭好环境只是第一步，接下来需要进一步研究WebRTC的编译和源码实现了，包括研究其如何用UDP保证低延时传输音视频流，如何处理网络抖动保证传输质量等。&lt;/p&gt;

</description>
        <pubDate>Thu, 23 Nov 2017 00:00:00 +0800</pubDate>
        <link>http://0.0.0.0:4000/2017/11/23/have_fun_with_webrtc_1/</link>
        <guid isPermaLink="true">http://0.0.0.0:4000/2017/11/23/have_fun_with_webrtc_1/</guid>
        
        <category>WebRTC</category>
        
        
      </item>
    
      <item>
        <title>树莓派监控室内pm2.5数据并使用grafana+influxdb展现</title>
        <description>&lt;div id=&quot;wx_logo&quot; style=&quot;margin:0 auto;display:none;&quot;&gt;
&lt;img src=&quot;/img/v.jpg&quot; /&gt;
&lt;/div&gt;

&lt;p&gt;2016快要结束的一个多月,北京的雾霾天又开始严重起来了,而且这一次生理上的不适感比之前大了不少。
也许是经过北京这几年生活累加伤害所至吧。&lt;/p&gt;

&lt;p&gt;调研了一下pm2.5对人体的危害和中美空气污染的标准，感觉事情比我原来想的要严重很多。
考虑到家里有老人和小孩，于是决定对此事认真起来，希望找出一个彻底的解决方案。&lt;/p&gt;

&lt;p&gt;在定解决方案之前，先来个定量分析吧。可是网上卖的测量仪基本都要小一千（比如汉王的霾表）而且这种产品还是不方便动态监测pm2.5的变化。&lt;/p&gt;

&lt;p&gt;最后在淘宝上看到有人拿攀藤科技的传感器做了&lt;a href=&quot;https://item.taobao.com/item.htm?spm=a1z09.2.0.0.0G9oyg&amp;amp;id=39422337670&amp;amp;_u=i40493rf6c2&quot;&gt;简易测量仪&lt;/a&gt;，而且还能提供数据的输出接口。&lt;/p&gt;

&lt;p&gt;下面记录了使用的步骤和分析得到的结论&lt;/p&gt;

&lt;h2 id=&quot;1获取室内可吸入颗粒物pm25pm10的浓度&quot;&gt;1.获取室内可吸入颗粒物pm2.5/pm10的浓度&lt;/h2&gt;

&lt;p&gt;在定制的攀藤传感器上接一个usb模，连接到pi上，通过下面的python代码可以读取数据，并且根据传感器文档，能够解析出具体的数据&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;ser&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;serial&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Serial&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'/dev/ttyUSB0'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;timeout&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;data_n&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;37&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;read_n&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;37&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;head&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x42\x4d&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;pool&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ser&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;read_n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;pool&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;offset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pool&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;find&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;head&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;offset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;elif&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;offset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;pool&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pool&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;offset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:]&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pool&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;data_n:
            &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;ss&quot;&gt;else:
            &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;read_n&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data_n&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pool&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pool&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;data_n:
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;frame&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;struct&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;unpack&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&amp;gt;HHHHHHHHHHHHHHHHHHc&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pool&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;2获取室外污染指数&quot;&gt;2.获取室外污染指数&lt;/h2&gt;

&lt;p&gt;使用的是aqicn.org上的数据，该网站提供的API用于在程序中实时获取当前数据，只需要注册一个用户就行。
xxx是你注册用户后得到的一个私有key&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;get_aqicn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;weather_url&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;http://api.waqi.info/feed/beijing/?token=xxx&quot;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;req&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;urllib2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;weather_url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;headers&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;headers&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;resp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;urllib2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;urlopen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;req&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;content&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;resp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;weatherJSON&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;json&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;JSONDecoder&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;decode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;ss&quot;&gt;try:
            &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;weatherJSON&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'status'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;ok&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;weatherJSON&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'data'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;has_key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'iaqi'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;  &lt;span class=&quot;n&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;weatherJSON&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'data'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;][&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'iaqi'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;][&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'pm25'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;][&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'v'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;  &lt;span class=&quot;n&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;weatherJSON&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'data'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;][&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'iaqi'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;][&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'pm10'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;][&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'v'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;
                    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;ss&quot;&gt;else:
                    &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;no iaqi found&quot;&lt;/span&gt;
                    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;None&lt;/span&gt;
            &lt;span class=&quot;ss&quot;&gt;else:
                &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;no ok found&quot;&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;None&lt;/span&gt;
        &lt;span class=&quot;ss&quot;&gt;except:
            &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;except found&quot;&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;None&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;由于aqicn.org只提供污染指数而没有提供具体的污染物浓度，为了便与和室内的数据进行对比，可以将室内的污染物浓度换算成污染指数。&lt;/strong&gt;
具体换算公式可以在&lt;a href=&quot;http://www.guokr.com/post/431588/&quot;&gt;果壳网&lt;/a&gt;或wikipedia上得到&lt;/p&gt;

&lt;h2 id=&quot;3将采集到的数据进行图形化展示&quot;&gt;3.将采集到的数据进行图形化展示&lt;/h2&gt;

&lt;p&gt;图形化方案使用的是&lt;strong&gt;telegraf(数据收集)+influxdb(数据存储)+grafana(数据展示)&lt;/strong&gt;，具体的安装配置下次有空再说了&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;msg&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;aqi,loc=%s pm25=%d,pm25_aqi=%d,pm10=%d,pm10_aqi=%d,form=%f %ld&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;\&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;outdoor&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;outdoor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;outdoor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;这里就说一点，采集到的数据只要按上述格式往telegraf的监听地址发送即可写入influxdb中。
这里可以将influxdb和普通的关系型数据库mysql做个对比
aqi相当于mysql的一张表（可自动生成）
loc相当于字段（主键）
pm25,pm25_aqi,pm10,pm10_aqi,form等相当于非主键（注意loc和pm25之间是空格分隔而不是逗号）
最后的%ld ts是influxdb特有的时间戳数据，因为influxdb就是用来存储时间序列值的
至于上述数据是写到哪个库中，是在telegraf的配置中指定，每个telegraf进程实例接收到的数据都会全部写到指定的数据库中&lt;/p&gt;

&lt;h2 id=&quot;4结论&quot;&gt;4.结论&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;在关窗的情况下，室内的污染指数相当于室外的一半。也就是说如果室外是300，室内就是150.这在美标的显示中是&lt;strong&gt;“very unhealthy”&lt;/strong&gt;
所以不要以为晚上你的卧室的空气很好，其实在睡眠的时候你是一直在受到伤害的。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;自住房内空气净化的最佳解决方案应该是新风系统，不但能净化空气而且能保持室内充足的含氧量。
次优的解决方案是&lt;a href=&quot;https://detail.tmall.com/item.htm?id=540103289206&amp;amp;spm=a1z09.2.0.0.0G9oyg&amp;amp;_u=i40493r89cd&quot;&gt;ffu&lt;/a&gt;，它的净化效果（CARD）是普通净化器的3-5倍，价格也很亲民，而且强风档噪音只相当于普通的立式空调。
最终我采用的是ffu+普通净化器的方案，客厅放ffu每个卧室放小米净化器。
基本上能在室外爆表的情况下，室内pm2.5浓度不超过40毫克/立方米，基本接近美标优秀（20）的水平。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;对于办公室的净化方案，可以用&lt;a href=&quot;https://item.jd.com/1753326931.html&quot;&gt;肺宝&lt;/a&gt;，虽然有点不美观，但效果是很好的。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;口说无凭，数据说话，下面列出的2017年元旦北京最长的一次跨年雾霾期间室内、室外、办公室的污染对比
&lt;strong&gt;(家中pm2.5浓度的波峰是因为做饭油烟所致与室外污染物无关)&lt;/strong&gt;&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/img/2016-12-29-raspberry-pi-pm25-monitor/aqi.jpg&quot; alt=&quot;AQI&quot; title=&quot;aqi&quot; /&gt;&lt;/p&gt;

</description>
        <pubDate>Thu, 29 Dec 2016 00:00:00 +0800</pubDate>
        <link>http://0.0.0.0:4000/2016/12/29/raspberry-pi-pm25-monitor/</link>
        <guid isPermaLink="true">http://0.0.0.0:4000/2016/12/29/raspberry-pi-pm25-monitor/</guid>
        
        <category>树莓派</category>
        
        
      </item>
    
      <item>
        <title>树莓派通过hls实现24*7监控摄像流媒体直播</title>
        <description>&lt;div id=&quot;wx_logo&quot; style=&quot;margin:0 auto;display:none;&quot;&gt;
&lt;img src=&quot;/img/v.jpg&quot; /&gt;
&lt;/div&gt;

&lt;p&gt;自从全叔介绍我玩树莓派以来，越来越发现这小东西的可玩性很高。总结起来它可玩性如此高的原因下面几点：
体积小、价格便宜、接口多、能耗少（可做24*7服务器用）、架构通用，软件丰富&lt;/p&gt;

&lt;p&gt;这两天买了个原装的&lt;a href=&quot;http://elinux.org/File:RPiCam.jpg&quot;&gt;摄像卡&lt;/a&gt;（非usb,不能采集音频），搭建一个24*7的监控流媒体播放服务器，步骤如下：&lt;/p&gt;

&lt;h2 id=&quot;1通过raspberry自带的raspivid采集原始h264流&quot;&gt;1.通过raspberry自带的raspivid采集原始H264流&lt;/h2&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;raspivid  &lt;span class=&quot;nt&quot;&gt;-vf&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-hf&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-n&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-ih&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; 0 &lt;span class=&quot;nt&quot;&gt;-ISO&lt;/span&gt; 800 &lt;span class=&quot;nt&quot;&gt;-ex&lt;/span&gt; night &lt;span class=&quot;nt&quot;&gt;-w&lt;/span&gt; 720 &lt;span class=&quot;nt&quot;&gt;-h&lt;/span&gt; 405 &lt;span class=&quot;nt&quot;&gt;-fps&lt;/span&gt; 25 &lt;span class=&quot;nt&quot;&gt;-b&lt;/span&gt; 500000 &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; -| ffmpeg &lt;span class=&quot;nt&quot;&gt;-y&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-loglevel&lt;/span&gt; panic &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; - &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt;:v copy &lt;span class=&quot;nt&quot;&gt;-map&lt;/span&gt; 0 &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; ssegment &lt;span class=&quot;nt&quot;&gt;-segment_time&lt;/span&gt; 1 &lt;span class=&quot;nt&quot;&gt;-segment_format&lt;/span&gt; mpegts &lt;span class=&quot;nt&quot;&gt;-segment_list&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;/var/www/hls/stream.m3u8&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-segment_list_size&lt;/span&gt; 80 &lt;span class=&quot;nt&quot;&gt;-segment_wrap&lt;/span&gt; 80 &lt;span class=&quot;nt&quot;&gt;-segment_list_flags&lt;/span&gt; +live &lt;span class=&quot;nt&quot;&gt;-segment_list_type&lt;/span&gt; m3u8 &lt;span class=&quot;s2&quot;&gt;&quot;/var/www/hls/%03d.ts&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;因为摄像头是倒放的所以加了-vf -hf参数
考虑到联通10M光纤上行只有1M，采集的码率限制500000（500Kbit）&lt;/p&gt;

&lt;h2 id=&quot;2ffmpeg吃进原始h264流分隔后吐出hls文件m3u8和ts&quot;&gt;2.ffmpeg吃进原始H264流，分隔后吐出hls文件（m3u8和ts）&lt;/h2&gt;
&lt;p&gt;命令见步骤1
&lt;strong&gt;考虑到长时间对SD卡的不隔断读写，可以使用虚拟内存文件系统&lt;/strong&gt;
mount -t tmpfs -o size=16M tmpfs  /var/www/hls
防止吃光内存，最大只分配16M使用。&lt;/p&gt;

&lt;h2 id=&quot;3前端页面挂上播放地址&quot;&gt;3.前端页面挂上播放地址&lt;/h2&gt;

&lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;video&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;width=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;720&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;height=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;480&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;controls=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;controls&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;video&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;autoplay=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;autoplay&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;source&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;src=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;hls/stream.m3u8&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;application/x-mpegURL&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/video&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;目前只适配VLC/android/IOS的http协议，https对android还不支持.
有时间再研究在PC浏览器支持http/https播放，以及android的https播放&lt;/p&gt;

&lt;h2 id=&quot;4总结&quot;&gt;4.总结&lt;/h2&gt;
&lt;p&gt;实际在树莓派2(4核心,1GB RAM)上运行毫无压力，dstat输出如下：
&lt;img src=&quot;/img/2015-04-23-raspberry-pi-http-live-streaming/dstat.jpg&quot; alt=&quot;DSTAT&quot; title=&quot;dstat&quot; /&gt;&lt;/p&gt;

</description>
        <pubDate>Thu, 23 Apr 2015 00:00:00 +0800</pubDate>
        <link>http://0.0.0.0:4000/2015/04/23/raspberry-pi-http-live-streaming/</link>
        <guid isPermaLink="true">http://0.0.0.0:4000/2015/04/23/raspberry-pi-http-live-streaming/</guid>
        
        <category>树莓派</category>
        
        
      </item>
    
      <item>
        <title>马云接受《南华早报》记者采访完整录音</title>
        <description>&lt;div id=&quot;wx_logo&quot; style=&quot;margin:0 auto;display:none;&quot;&gt;
&lt;img src=&quot;/img/bat.jpg&quot; /&gt;
&lt;/div&gt;

&lt;p&gt;这个录音是翻墙从youtube上拔下来的，由&lt;a href=&quot;http://www.baofengcloud.com/product/paas.html&quot;&gt;暴风云托管服务&lt;/a&gt;提供技术支持。&lt;/p&gt;

&lt;p&gt;马云提到下面几点有点意思：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;电子商务三条流：数据流、资金流、物流；电商平台不能自己建设完整的物流基础设施；（潜台词就是完全不看好京东）&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;马云个人竟然是华谊兄弟影业的两兄弟以外的第三大股东，华谊的整个管理体系是马云参与建立的；&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;马云说阿里是一个以管理见长的公司，而不是以技术与产品见长，管理水平绝对在腾迅和百度之上；（结合公司文化占阿里入职考核60%比重的传闻来看，马云是下大功夫了）&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;从管理角度考虑，马云支持邓小平当年对六4事件的处理方式；&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;下载方式：鼠标右击播放器选择另存为&lt;/strong&gt;&lt;/p&gt;

&lt;video width=&quot;320&quot; height=&quot;240&quot; controls=&quot;controls&quot; id=&quot;video&quot; autoplay=&quot;autoplay&quot; type=&quot;video/mp4&quot;&gt;
    &lt;script type=&quot;text/javascript&quot;&gt;
        jQuery(document).ready(function(){
            $.ajax({
                type: &quot;get&quot;,
                async: false,
                url: &quot;http://cdnquery.baofengcloud.com/c2VydmljZXR5cGU9MCZ1aWQ9NTI1MzE1OSZmaWQ9N0IyQ0FFNTA1NDJBNDc4OTNCOUZDMDIxQTE2N0I5NzY=&quot;,
                dataType: &quot;json&quot;,
                success: function(json) {
                    document.getElementById('video').src = json.urllist[0];
                },
            });
        });
    &lt;/script&gt;
&lt;/video&gt;

</description>
        <pubDate>Wed, 08 Apr 2015 00:00:00 +0800</pubDate>
        <link>http://0.0.0.0:4000/2015/04/08/jack-ma-nanzao-interview/</link>
        <guid isPermaLink="true">http://0.0.0.0:4000/2015/04/08/jack-ma-nanzao-interview/</guid>
        
        <category>商业</category>
        
        
      </item>
    
      <item>
        <title>暴风云视频横空出世</title>
        <description>&lt;div id=&quot;wx_logo&quot; style=&quot;margin:0 auto;display:none;&quot;&gt;
&lt;img src=&quot;/img/2015-03-01-baofeng-cloud-online/bfc.jpg&quot; /&gt;
&lt;/div&gt;

&lt;p&gt;强力团队历时半年打造，基于多年在线视频领域的技术积累和运营经验，为广大用户提供点播、直播等业务的一站式解决方案。
&lt;a href=&quot;http://www.baofengcloud.com&quot;&gt;官方网站&lt;/a&gt;
&lt;a href=&quot;http://weibo.com/u/5274297492&quot;&gt;官方微博&lt;/a&gt;
&lt;a href=&quot;http://bbs.baofengcloud.com/forum.php&quot;&gt;官方论坛&lt;/a&gt;&lt;/p&gt;

&lt;video width=&quot;320&quot; height=&quot;240&quot; controls=&quot;controls&quot; id=&quot;video&quot; autoplay=&quot;autoplay&quot; type=&quot;video/mp4&quot;&gt;
    &lt;script type=&quot;text/javascript&quot;&gt;
        jQuery(document).ready(function(){
            $.ajax({
                type: &quot;get&quot;,
                async: false,
                url: &quot;http://cdnquery.baofengcloud.com/c2VydmljZXR5cGU9MCZ1aWQ9NTI1MzE1OSZmaWQ9MjE0MDc3RjIyNzY4N0RBRDlFNUQ1MDZFQUNDRTkxMzk=&quot;,
                dataType: &quot;json&quot;,
                success: function(json) {
                    document.getElementById('video').src = json.urllist[0];
                },
            });
        });
    &lt;/script&gt;
&lt;/video&gt;

&lt;p&gt;&lt;img src=&quot;/img/2015-03-01-baofeng-cloud-online/logo.jpg&quot; alt=&quot;BaofengCloud&quot; title=&quot;暴风云视频logo&quot; /&gt;&lt;/p&gt;
</description>
        <pubDate>Sun, 01 Mar 2015 00:00:00 +0800</pubDate>
        <link>http://0.0.0.0:4000/2015/03/01/baofeng-cloud-online/</link>
        <guid isPermaLink="true">http://0.0.0.0:4000/2015/03/01/baofeng-cloud-online/</guid>
        
        <category>项目</category>
        
        
      </item>
    
      <item>
        <title>markdown把玩记</title>
        <description>&lt;p&gt;这几天试着用github博客系统发布用&lt;a href=&quot;http://daringfireball.net/projects/markdown&quot;&gt;markdown&lt;/a&gt;写的日志，发现GitHub默认的markdown解析器&lt;a href=&quot;http://kramdown.gettalong.org/index.html&quot;&gt;kramdown&lt;/a&gt;对一些程序员比较实用的markdown扩展支持不好，比如：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;数学公式&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;内容表格TOC&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;代码高亮&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;流程图&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;UML时序图&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;这些特性已经被一些Windows端的markdown编辑器支持, 比如让人眼前一亮的&lt;a href=&quot;http://www.maxiang.info/&quot;&gt;飞象马克&lt;/a&gt;。
所以花了一点时间把飞象马克宣传页的markdown特性调到GitHub博客上。&lt;/p&gt;

&lt;p&gt;最后的结果没有想象的好, 主要是GitHub的Jekyll引擎对流程图和时序图的语法不支持，必须写额外的转换&lt;a href=&quot;http://jekyllrb.com/docs/plugins/&quot;&gt;插件&lt;/a&gt;，但就算写好了插件提交到GitHub上，GitHub因为自身的安全机制也不会替你自动加载，所以这个问题暂时无解。(有谁知道请告诉我)&lt;/p&gt;

&lt;p&gt;我最后用的workaround是直接在markdown文档中插入原始html代码，跳过Jekyll的转换。虽然比较ugly，但是除了语法本身，额外的代码不多，先忍着吧。&lt;/p&gt;

&lt;p&gt;下面请看效果吧:&lt;/p&gt;

&lt;hr /&gt;

&lt;h1 id=&quot;欢迎使用马克飞象&quot;&gt;欢迎使用马克飞象&lt;/h1&gt;

&lt;table&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;@(示例笔记本)[马克飞象&lt;/td&gt;
      &lt;td&gt;帮助&lt;/td&gt;
      &lt;td&gt;Markdown]&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;&lt;strong&gt;马克飞象&lt;/strong&gt;是一款专为印象笔记（Evernote）打造的Markdown编辑器，通过精心的设计与技术实现，配合印象笔记强大的存储和同步功能，带来前所未有的书写体验。特点概述：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;功能丰富&lt;/strong&gt; ：支持高亮代码块、&lt;em&gt;LaTex&lt;/em&gt; 公式、流程图，本地图片上传甚至截图粘贴，工作学习好帮手；&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;得心应手&lt;/strong&gt; ：简洁高效的编辑器，提供桌面&lt;a href=&quot;https://chrome.google.com/webstore/detail/kidnkfckhbdkfgbicccmdggmpgogehop&quot;&gt;离线客户端&lt;/a&gt;，支持移动端 Web；&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;深度整合&lt;/strong&gt; ：支持选择笔记本和添加标签，支持从印象笔记跳转编辑，轻松管理。&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#欢迎使用马克飞象&quot; id=&quot;markdown-toc-欢迎使用马克飞象&quot;&gt;欢迎使用马克飞象&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#markdown简介&quot; id=&quot;markdown-toc-markdown简介&quot;&gt;Markdown简介&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#代码块&quot; id=&quot;markdown-toc-代码块&quot;&gt;代码块&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#latex-公式&quot; id=&quot;markdown-toc-latex-公式&quot;&gt;LaTex 公式&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#表格&quot; id=&quot;markdown-toc-表格&quot;&gt;表格&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#流程图-flow&quot; id=&quot;markdown-toc-流程图-flow&quot;&gt;流程图 flow&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#时序图-sequence&quot; id=&quot;markdown-toc-时序图-sequence&quot;&gt;时序图 sequence&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#复选框&quot; id=&quot;markdown-toc-复选框&quot;&gt;复选框&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#印象笔记相关&quot; id=&quot;markdown-toc-印象笔记相关&quot;&gt;印象笔记相关&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#笔记本和标签&quot; id=&quot;markdown-toc-笔记本和标签&quot;&gt;笔记本和标签&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#笔记标题&quot; id=&quot;markdown-toc-笔记标题&quot;&gt;笔记标题&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#快捷编辑&quot; id=&quot;markdown-toc-快捷编辑&quot;&gt;快捷编辑&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#数据同步&quot; id=&quot;markdown-toc-数据同步&quot;&gt;数据同步&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#离线存储&quot; id=&quot;markdown-toc-离线存储&quot;&gt;离线存储&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#编辑器相关&quot; id=&quot;markdown-toc-编辑器相关&quot;&gt;编辑器相关&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#设置&quot; id=&quot;markdown-toc-设置&quot;&gt;设置&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#快捷键&quot; id=&quot;markdown-toc-快捷键&quot;&gt;快捷键&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#关于收费&quot; id=&quot;markdown-toc-关于收费&quot;&gt;关于收费&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#反馈与建议&quot; id=&quot;markdown-toc-反馈与建议&quot;&gt;反馈与建议&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;markdown简介&quot;&gt;Markdown简介&lt;/h2&gt;

&lt;blockquote&gt;
  &lt;p&gt;Markdown 是一种轻量级标记语言，它允许人们使用易读易写的纯文本格式编写文档，然后转换成格式丰富的HTML页面。    —— &lt;a href=&quot;https://zh.wikipedia.org/wiki/Markdown&quot;&gt;维基百科&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;正如您在阅读的这份文档，它使用简单的符号标识不同的标题，将某些文字标记为&lt;strong&gt;粗体&lt;/strong&gt;或者&lt;em&gt;斜体&lt;/em&gt;，创建一个&lt;a href=&quot;http://www.example.com&quot;&gt;链接&lt;/a&gt;或一个脚注&lt;sup id=&quot;fnref:demo&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:demo&quot; class=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;。下面列举了几个高级功能，更多语法请按&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Ctrl + /&lt;/code&gt;查看帮助。&lt;/p&gt;

&lt;h3 id=&quot;代码块&quot;&gt;代码块&lt;/h3&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;requires_authorization&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;somefunc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;param1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;param2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;'''A docstring'''&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;param1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;param2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# interesting
&lt;/span&gt;        &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'Greater'&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;param2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;param1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;or&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;None&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;SomeClass&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;pass&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;message&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'''interpreter
... prompt'''&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;latex-公式&quot;&gt;LaTex 公式&lt;/h3&gt;

&lt;p&gt;可以创建行内公式，例如 $\Gamma(n) = (n-1)!\quad\forall n\in\mathbb N$。或者块级公式：&lt;/p&gt;

\[x = \dfrac{-b \pm \sqrt{b^2 - 4ac}}{2a}\]

&lt;h3 id=&quot;表格&quot;&gt;表格&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;Item&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Value&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;Qty&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Computer&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1600 USD&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;5&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Phone&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;12 USD&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;12&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Pipe&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1 USD&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;234&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&quot;流程图-flow&quot;&gt;流程图 flow&lt;/h3&gt;

&lt;div id=&quot;flow-canvas&quot;&gt;&lt;/div&gt;
&lt;script&gt;

var code = 
&quot;st=&gt;start: Start\n\
e=&gt;end\n\
op=&gt;operation: My Operation\n\
cond=&gt;condition: Yes or No?\n\
st-&gt;op-&gt;cond\n\
cond(yes)-&gt;e\n\
cond(no)-&gt;op&quot;;

flowchart.parse(code).drawSVG('flow-canvas');
&lt;/script&gt;

&lt;p&gt;对应的HTML代码：&lt;/p&gt;

&lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;flow-canvas&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;script&amp;gt;&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;code&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 
&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;st=&amp;gt;start: Start&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n\&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;
e=&amp;gt;end&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n\&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;
op=&amp;gt;operation: My Operation&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n\&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;
cond=&amp;gt;condition: Yes or No?&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n\&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;
st-&amp;gt;op-&amp;gt;cond&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n\&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;
cond(yes)-&amp;gt;e&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n\&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;
cond(no)-&amp;gt;op&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;nx&quot;&gt;flowchart&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;parse&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;code&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;drawSVG&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;flow-canvas&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;时序图-sequence&quot;&gt;时序图 sequence&lt;/h3&gt;

&lt;div id=&quot;seq-canvas&quot;&gt;&lt;/div&gt;
&lt;script&gt;

var code =
&quot;Alice-&gt;Bob: Hello Bob, how are you?\n\
Note right of Bob: Bob thinks\n\
Bob--&gt;Alice: I am good thanks!&quot;;

Diagram.parse(code).drawSVG(&quot;seq-canvas&quot;, {theme: 'simple'});
&lt;/script&gt;

&lt;p&gt;对应的HTML代码：&lt;/p&gt;

&lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;seq-canvas&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;script&amp;gt;&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;code&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Alice-&amp;gt;Bob: Hello Bob, how are you?&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n\&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;
Note right of Bob: Bob thinks&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n\&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;
Bob--&amp;gt;Alice: I am good thanks!&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;nx&quot;&gt;Diagram&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;parse&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;code&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;drawSVG&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;seq-canvas&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;theme&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;simple&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;提示：&lt;/strong&gt;想了解更多，请查看&lt;strong&gt;流程图&lt;/strong&gt;&lt;a href=&quot;http://adrai.github.io/flowchart.js/&quot;&gt;语法&lt;/a&gt;以及&lt;strong&gt;时序图&lt;/strong&gt;&lt;a href=&quot;http://bramp.github.io/js-sequence-diagrams/&quot;&gt;语法&lt;/a&gt;。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;复选框&quot;&gt;复选框&lt;/h3&gt;

&lt;p&gt;使用 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;- [ ]&lt;/code&gt; 和 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;- [x]&lt;/code&gt; 语法可以创建复选框，实现 todo-list 等功能。例如：&lt;/p&gt;

&lt;ul class=&quot;task-list&quot;&gt;
  &lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; class=&quot;task-list-item-checkbox&quot; disabled=&quot;disabled&quot; checked=&quot;checked&quot; /&gt;已完成事项&lt;/li&gt;
  &lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; class=&quot;task-list-item-checkbox&quot; disabled=&quot;disabled&quot; /&gt;待办事项1&lt;/li&gt;
  &lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; class=&quot;task-list-item-checkbox&quot; disabled=&quot;disabled&quot; /&gt;待办事项2&lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;注意：&lt;/strong&gt;目前支持尚不完全，在印象笔记中勾选复选框是无效、不能同步的，所以必须在&lt;strong&gt;马克飞象&lt;/strong&gt;中修改 Markdown 原文才可生效。下个版本将会全面支持。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;印象笔记相关&quot;&gt;印象笔记相关&lt;/h2&gt;

&lt;h3 id=&quot;笔记本和标签&quot;&gt;笔记本和标签&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;马克飞象&lt;/strong&gt;增加了&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;@(笔记本)[标签A|标签B]&lt;/code&gt;语法, 以选择笔记本和添加标签。 &lt;strong&gt;绑定账号后&lt;/strong&gt;， 输入&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;(&lt;/code&gt;自动会出现笔记本列表，请从中选择。&lt;/p&gt;

&lt;h3 id=&quot;笔记标题&quot;&gt;笔记标题&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;马克飞象&lt;/strong&gt;会自动使用文档内出现的第一个标题作为笔记标题。例如本文，就是第一行的 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;欢迎使用马克飞象&lt;/code&gt;。&lt;/p&gt;

&lt;h3 id=&quot;快捷编辑&quot;&gt;快捷编辑&lt;/h3&gt;
&lt;p&gt;保存在印象笔记中的笔记，右上角会有一个红色的编辑按钮，点击后会回到&lt;strong&gt;马克飞象&lt;/strong&gt;中打开并编辑该笔记。&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;注意：&lt;/strong&gt;目前用户在印象笔记中单方面做的任何修改，马克飞象是无法自动感知和更新的。所以请务必回到马克飞象编辑。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;数据同步&quot;&gt;数据同步&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;马克飞象&lt;/strong&gt;通过&lt;strong&gt;将Markdown原文以隐藏内容保存在笔记中&lt;/strong&gt;的精妙设计，实现了对Markdown的存储和再次编辑。既解决了其他产品只是单向导出HTML的单薄，又规避了服务端存储Markdown带来的隐私安全问题。这样，服务端仅作为对印象笔记 API调用和数据转换之用。&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;隐私声明：用户所有的笔记数据，均保存在印象笔记中。马克飞象不存储用户的任何笔记数据。&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;离线存储&quot;&gt;离线存储&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;马克飞象&lt;/strong&gt;使用浏览器离线存储将内容实时保存在本地，不必担心网络断掉或浏览器崩溃。为了节省空间和避免冲突，已同步至印象笔记并且不再修改的笔记将删除部分本地缓存，不过依然可以随时通过&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;文档管理&lt;/code&gt;打开。&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;注意：&lt;/strong&gt;虽然浏览器存储大部分时候都比较可靠，但印象笔记作为专业云存储，更值得信赖。以防万一，&lt;strong&gt;请务必经常及时同步到印象笔记&lt;/strong&gt;。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;编辑器相关&quot;&gt;编辑器相关&lt;/h2&gt;

&lt;h3 id=&quot;设置&quot;&gt;设置&lt;/h3&gt;

&lt;p&gt;右侧系统菜单（快捷键&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Ctrl + M&lt;/code&gt;）的&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;设置&lt;/code&gt;中，提供了界面字体、字号、自定义CSS、vim/emacs 键盘模式等高级选项。&lt;/p&gt;

&lt;h3 id=&quot;快捷键&quot;&gt;快捷键&lt;/h3&gt;

&lt;p&gt;帮助    &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Ctrl + /&lt;/code&gt;
同步文档    &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Ctrl + S&lt;/code&gt;
创建文档    &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Ctrl + Alt + N&lt;/code&gt;
最大化编辑器    &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Ctrl + Enter&lt;/code&gt;
预览文档 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Ctrl + Alt + Enter&lt;/code&gt;
文档管理    &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Ctrl + O&lt;/code&gt;
系统菜单    &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Ctrl + M&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;加粗    &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Ctrl + B&lt;/code&gt;
插入图片    &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Ctrl + G&lt;/code&gt;
插入链接    &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Ctrl + L&lt;/code&gt;
提升标题    &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Ctrl + H&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;关于收费&quot;&gt;关于收费&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;马克飞象&lt;/strong&gt;为新用户提供 10 天的试用期，试用期过后需要&lt;a href=&quot;maxiang.info/vip.html&quot;&gt;续费&lt;/a&gt;才能继续使用。未购买或者未及时续费，将不能同步新的笔记。之前保存过的笔记依然可以编辑。&lt;/p&gt;

&lt;h2 id=&quot;反馈与建议&quot;&gt;反馈与建议&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;微博：&lt;a href=&quot;http://weibo.com/u/2788354117&quot;&gt;@马克飞象&lt;/a&gt;，&lt;a href=&quot;http://weibo.com/ggock&quot; title=&quot;开发者个人账号&quot;&gt;@GGock&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;邮箱：&lt;a href=&quot;mailto:hustgock@gmail.com&quot;&gt;hustgock@gmail.com&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;
&lt;p&gt;感谢阅读这份帮助文档。请点击右上角，绑定印象笔记账号，开启全新的记录与分享体验吧。&lt;/p&gt;

&lt;div class=&quot;footnotes&quot; role=&quot;doc-endnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:demo&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;这是一个示例脚注。请查阅 &lt;a href=&quot;https://github.com/fletcher/MultiMarkdown/wiki/MultiMarkdown-Syntax-Guide#footnotes&quot;&gt;MultiMarkdown 文档&lt;/a&gt; 关于脚注的说明。 &lt;strong&gt;限制：&lt;/strong&gt; 印象笔记的笔记内容使用 &lt;a href=&quot;https://dev.yinxiang.com/doc/articles/enml.php&quot;&gt;ENML&lt;/a&gt; 格式，基于 HTML，但是不支持某些标签和属性，例如id，这就导致&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;脚注&lt;/code&gt;和&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;TOC&lt;/code&gt;无法正常点击。 &lt;a href=&quot;#fnref:demo&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;
</description>
        <pubDate>Thu, 19 Feb 2015 00:00:00 +0800</pubDate>
        <link>http://0.0.0.0:4000/2015/02/19/markdown/</link>
        <guid isPermaLink="true">http://0.0.0.0:4000/2015/02/19/markdown/</guid>
        
        <category>markdown</category>
        
        
      </item>
    
      <item>
        <title>matrix一期总结</title>
        <description>&lt;p&gt;半年时间写了几个服务器，收获不少。有如下心得。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;系统想清楚再开发其实就容易很多。&lt;/li&gt;
  &lt;li&gt;不要在头脑不清楚的时候写复杂核心逻辑，不然bug会多得爽死你。&lt;/li&gt;
  &lt;li&gt;上线一定跑valgrind，不要忘掉invaild read/write提示，有可能是潜在的崩溃。&lt;/li&gt;
  &lt;li&gt;与其它系统耦合度高的系统开发，一定要加全日志和验证工具，为的是迅速定位问题，降低沟通成本。&lt;/li&gt;
  &lt;li&gt;数据结构按业务尽量分开，不然混在一起扩展性维护性很差。&lt;/li&gt;
&lt;/ul&gt;

</description>
        <pubDate>Tue, 20 Jan 2015 00:00:00 +0800</pubDate>
        <link>http://0.0.0.0:4000/2015/01/20/matrix-I-summary/</link>
        <guid isPermaLink="true">http://0.0.0.0:4000/2015/01/20/matrix-I-summary/</guid>
        
        <category>项目</category>
        
        
      </item>
    
      <item>
        <title>第一篇</title>
        <description>&lt;p&gt;&lt;img src=&quot;/img/2014-12-31-first-article/Buck_The_Character.jpg&quot; alt=&quot;Buck_The_Character&quot; title=&quot;That is me&quot; /&gt;&lt;/p&gt;

&lt;p&gt;开博的想法已经很久了，赶在2014结束前开起来。&lt;/p&gt;

&lt;h1 id=&quot;关于目的&quot;&gt;关于目的&lt;/h1&gt;

&lt;h1 id=&quot;关于内容&quot;&gt;关于内容&lt;/h1&gt;

&lt;h2 id=&quot;感想&quot;&gt;感想&lt;/h2&gt;

&lt;h2 id=&quot;总结&quot;&gt;总结&lt;/h2&gt;

&lt;h2 id=&quot;笔记&quot;&gt;笔记&lt;/h2&gt;
</description>
        <pubDate>Wed, 31 Dec 2014 00:00:00 +0800</pubDate>
        <link>http://0.0.0.0:4000/2014/12/31/first-article/</link>
        <guid isPermaLink="true">http://0.0.0.0:4000/2014/12/31/first-article/</guid>
        
        <category>^_^</category>
        
        
      </item>
    
      <item>
        <title>前一篇</title>
        <description>&lt;h1 id=&quot;有限的感观sensation无限的理智reason&quot;&gt;有限的感观(sensation)，无限的理智(reason)&lt;/h1&gt;

&lt;p&gt;今天的早上梦里的那种感觉已经是这两个月第两次了，这次一定要记录下来了。同样感觉的梦相信以前也有，但我早以忘记了。这两次梦里的感觉很美很美，虽然场景不同，但是就是美，说不出来的美。 
这种美是我在现实生活从来没有体会到的。 
这使我坚信一定存在一个远远超越人类感观（视，听，触，味，嗅）以外的世界。 
人的理智就像是一个深邃浩瀚的宇宙，而五种感观只是我们偷窥她的五扇小小的窗口。 
也许人只有在死后才有可能一揽她的全貌！&lt;br /&gt;
举个例子：人类的视觉&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;人的视觉是有限的&lt;/strong&gt; : 无法观察到可见光以外的红外光与紫外光&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;人的视觉有时是错误的&lt;/strong&gt; : 如光发生折射时 观察到的海市蜃楼就是假象&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;人的视觉是衰退的&lt;/strong&gt; : 随着年纪的增加 视力会慢慢变弱&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;也许只有在我们死去或梦里感觉到的世界才是真实的，活着和醒着的世界是被这五种感观严重扭曲的，不真实的，不完整的！&lt;/p&gt;

&lt;p&gt;这两次的梦除了具有不可描述的美感外，还有一个共同点，纯粹! 
除了我和梦境里的其它人物，物体，仿佛再也感觉不到其它任何东西了。&lt;/p&gt;

&lt;p&gt;简单描述我的最近的这两次特别的梦&lt;/p&gt;
&lt;h2 id=&quot;梦一&quot;&gt;梦一：&lt;/h2&gt;
&lt;p&gt;我（准第三视角）悬浮在漆黑的夜空中央，背后是深深的黑暗和未知，而我的前方是一团极为璀璨的，无比光芒的星云。星云的光浑洒在我的身上，星云的外围能看到一颗颗更亮的星星，星云好像正在慢慢的膨胀，我仿佛能感觉星云的温暖，感觉她会在不久之后将我融入。星云极为极为的明亮，但一点也不刺眼。&lt;/p&gt;

&lt;h2 id=&quot;梦二&quot;&gt;梦二：&lt;/h2&gt;
&lt;p&gt;我（第一视角）的前方两边是两座高山，高高的，窄窄的，一座山在画面的最左边，一座在最右边，山是绿色的，遍布绿色 茂盛的树。两山之间有一片狭长的平地，上面覆盖着嫩绿 嫩绿的草地，我好像能看到两个陌生的男人在走动，梦境里的重点是左边那座山山脚下的一棵银白的树，树上开满了花，像是樱花，但比樱花明亮。对，还有风，有点一微风，我能感觉到花在动，感觉到一丝凉意。&lt;/p&gt;

&lt;h1 id=&quot;欣赏美的能力&quot;&gt;欣赏美的能力：&lt;/h1&gt;

&lt;p&gt;这两次的梦真的很美 ，很美。。。。。。 
美得让我想到另外一个问题，生活中的人人都在抱怨痛苦与丑恶，但其实快乐和美是自已给自已的，是自发的(self-generated)，我们缺乏的也许是发现欣赏快乐与美的能力。 
举个例子：
你问一个9岁的小男孩生日礼物让他选任天堂的wii还是选20岁的苏菲玛索，他一定会选wii，因为此时的他还未被赋予某种能力–这种能力能使得这个乳嗅未干的小男孩有朝一日能体会成年女人的美，而这种美与快乐将远远超出wii游戏机几个数量级。 
这样说来，和整个自然宇宙相比，或许我们大部分的凡人都像那个9岁的小男样那样，仍远未被赋予足够的、完整的欣赏美的能力！&lt;/p&gt;

&lt;p&gt;思考比较零散，写得断断续续的。&lt;/p&gt;
</description>
        <pubDate>Wed, 14 Jul 2010 00:00:00 +0800</pubDate>
        <link>http://0.0.0.0:4000/2010/07/14/first-thoughts-on-aesthetics/</link>
        <guid isPermaLink="true">http://0.0.0.0:4000/2010/07/14/first-thoughts-on-aesthetics/</guid>
        
        <category>哲学</category>
        
        
      </item>
    
  </channel>
</rss>
